# 数据库切分概述

## 数据处理的两种类型

*   联机事务处理（OLTP）也称为面向交易的处理系统，其基本特征是原始数据可以立即传送到计算中心进行处理，并在很短的时间内给出处理结果。
*   联机分析处理（OLAP）是指通过多维的方式对数据进行分析、查询和报表，可以同数据挖掘工具、统计分析工具配合使用，增强决策分析功能。

|          | OLTP                             | OLAP                              |
| -------- | -------------------------------- | --------------------------------- |
| 系统功能 | 日常交易处理                     | 统计、分析、报表                  |
| DB设计   | 面向实时交易类应用               | 面向统计分析类应用                |
| 数据处理 | 当前的,最新的细节的,二维的分立的 | 历史的,聚集的,多维的集成的,统一的 |
| 实时性   | 实时读写要求高                   | 实时读写要求低                    |
| 事务     | 强一致性                         | 弱事务                            |
| 分析要求 | 低、简单                         | 高、复杂                          |

## 关系型数据库和非关系型数据库

*   关系型数据库，是建立在关系模型基础上的数据库，其借助于集合代数等数学概念和方法来处理数据库中的数据。主流的oracle、DB2、MSSQLServer和mysql都属于这类传统数据库。
*   NoSQL数据库，全称为Not Only SQL，意思就是适用关系型数据库的时候就使用关系型数据库，不适用的时候也没有必要非使用关系型数据库不可，可以考虑使用更加合适的数据存储。主要分为临时性键值存储（memcached、Redis）、永久性键值存储（ROMA、Redis）、面向文档的数据库（MongoDB、CouchDB）、面向列的数据库（Cassandra、HBase），每种NoSQL都有其特有的使用场景及优点。

|      | 关系型数据库                                                 | 非关系型数据库                                               |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 特点 | -数据关系模型基于关系模型，结构化存储，完整性约束
-基于二维表及其之间的联系，需要连接、并、交、差、除等数据操作
-采用结构化的查询语言（SQL）做数据读写
-操作需要数据的一致性，需要事务甚至是强一致性 | -非结构化的存储
-基于多维关系模型
-具有特有的使用场景          |
| 优点 | -保持数据的一致性（事务处理）
-可以进行join等复杂查询
-通用化，技术成熟 | -高并发，大数据下读写能力较强
-基本支持分布式，易于扩展，可伸缩
-简单，弱结构化存储 |
| 缺点 | -数据读写必须经过sql解析，大量数据、高并发下读写性能不足
-对数据做读写，或修改数据结构时需要加锁，影响并发操作
-无法适应非结构化存储-扩展困难
-昂贵、复杂 | -join等复杂操作能力较弱
-事务支持较弱
-通用性差
-无完整约束复杂业务场景支持较差 |

## 数据切分

​	**某种特定的条件，将我们存放在同一个数据库中的数据分散存放到多个数据库（主机）上面，以达到分散单台设备负载的效果。**数据的切分（Sharding）根据其切分规则的类型，可以分为两种切分模式。一种是按照不同的表（或者Schema）来切分到不同的数据库（主机）之上，这种切可以称之为数据的垂直（纵向）切分；另外一种则是根据表中的数据的逻辑关系，将同一个表中的数据按照某种条件拆分到多台数据库（主机）上面，这种切分称之为数据的水平（横向）切分。

### 垂直切分

​	垂直切分的最大特点就是规则简单，实施也更为方便，尤其适合各业务之间的耦合度非常低，相互影响很小，业务逻辑非常清晰的系统。在这种系统中，可以很容易做到将不同业务模块所使用的表分拆到不同的数据库中。根据不同的表来进行拆分，对应用程序的影响也更小，拆分规则也会比较简单清晰。

**优点: **

1.  拆分后业务清晰，拆分规则明确；
2.  系统之间整合或扩展容易；
3.  数据维护简单。

**缺点: **

1.  部分业务表无法join，只能通过接口方式解决，提高了系统复杂度；
2.  受每种业务不同的限制存在单库性能瓶颈，不易数据扩展跟性能提高；
3.  事务处理复杂。

**垂直切分无法解决单表数据量过于庞大的问题,所以存在单库读写性能瓶颈,可能需要引入水平切分来解决**

### 水平切分

​	相对于垂直拆分，水平拆分不是将表做分类，而是按照某个字段的某种规则来分散到多个库之中，每个表中包含一部分数据。简单来说，我们可以将数据的水平切分理解为是按照数据行的切分，就是将表中的某些行切分到一个数据库，而另外的某些行又切分到其他的数据库中。

**优点:**

1.  拆分规则抽象好，join操作基本可以数据库做；
2.  不存在单库大数据，高并发的性能瓶颈；
3.  应用端改造较少；
4.  提高了系统的稳定性跟负载能力。

**缺点:**

1.  拆分规则难以抽象；
2.  分片事务一致性难以解决；
3.  数据多次扩展难度跟维护量极大；
4.  跨库join性能较差。

### 数据切分的弊端

1.  引入分布式事务的问题；
2.  跨节点Join的问题；
3.  跨节点合并排序分页问题；
4.  多数据源管理问题。

### 数据源管理的两种思路

-   客户端模式，在每个应用程序模块中配置管理自己需要的一个（或者多个）数据源，直接访问各个数据库，在模块内完成数据的整合；
-   通过中间代理层来统一管理所有的数据源，后端数据库集群对前端应用程序透明；

------

# Mycat 概述

